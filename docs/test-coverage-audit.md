# Аудит покрытия тестами модулей Blocks и Segs

## Модуль Blocks

### Контроллеры без тестов:

1. **createBlock** - POST `/api/blocks`
   - Приоритет: Высокий
   - Причина: Основная операция создания сущности
   - Требует тестирования: валидация, создание блока, обработка дубликатов, обработка ошибок

2. **getAllBlocks** - GET `/api/blocks`
   - Приоритет: Средний
   - Причина: Операция чтения, используется часто
   - Требует тестирования: получение всех блоков, сортировка по порядку, обработка пустого списка

3. **getBlockById** - GET `/api/blocks/:id`
   - Приоритет: Средний
   - Причина: Операция чтения по ID
   - Требует тестирования: успешное получение, неверный ID, блок не найден

4. **updateBlock** - PUT `/api/blocks/:id`
   - Приоритет: Высокий
   - Причина: Операция изменения данных
   - Требует тестирования: обновление полей, валидация, обработка дубликатов, обработка ошибок

5. **renameBlock** - PATCH `/api/blocks/:id/rename`
   - Приоритет: Средний
   - Причина: Специализированная операция переименования
   - Требует тестирования: переименование, валидация, обработка дубликатов

6. **deleteBlock** - DELETE `/api/blocks/:id`
   - Приоритет: Высокий
   - Причина: Критичная операция удаления
   - Требует тестирования: удаление блока, каскадное удаление сегментов, обновление зон

7. **recalculateZonesSectors** - POST `/api/blocks/recalculate-zones-sectors`
   - Приоритет: Средний
   - Причина: Ресурсоемкая операция пересчета
   - Требует тестирования: пересчет секторов, обработка ошибок

8. **resetZonesSectors** - POST `/api/blocks/reset-zones-sectors`
   - Приоритет: Низкий
   - Причина: Утилитарная операция для инициализации
   - Требует тестирования: сброс секторов в 0

### Контроллеры с тестами:

- **upsertBlocksController** - POST `/api/blocks/upsert` (есть тест для утилиты)

## Модуль Segs

### Контроллеры без тестов:

1. **createSeg** - POST `/api/segs`
   - Приоритет: Высокий
   - Причина: Основная операция создания сущности
   - Требует тестирования: валидация, создание сегмента, проверка уникальности зон, обработка ошибок

2. **getAllSegs** - GET `/api/segs`
   - Приоритет: Средний
   - Причина: Операция чтения, используется часто
   - Требует тестирования: получение всех сегментов, сортировка по порядку, обработка пустого списка

3. **getSegById** - GET `/api/segs/:id`
   - Приоритет: Средний
   - Причина: Операция чтения по ID
   - Требует тестирования: успешное получение, неверный ID, сегмент не найден

4. **getSegsByBlockId** - GET `/api/segs/by-block/:blockId`
   - Приоритет: Средний
   - Причина: Операция чтения с фильтрацией
   - Требует тестирования: получение сегментов блока, сортировка, обработка несуществующего блока

5. **getZonesBySegId** - GET `/api/segs/:segId/zones`
   - Приоритет: Средний
   - Причина: Операция чтения связанных сущностей
   - Требует тестирования: получение зон сегмента, обработка несуществующего сегмента

6. **updateSeg** - PUT `/api/segs/:id`
   - Приоритет: Высокий
   - Причина: Операция изменения данных
   - Требует тестирования: обновление полей, валидация, проверка уникальности зон, обработка ошибок

7. **deleteSeg** - DELETE `/api/segs/:id`
   - Приоритет: Высокий
   - Причина: Критичная операция удаления
   - Требует тестирования: удаление сегмента, обновление зон, удаление из блока

### Контроллеры с тестами:

- **upsertSegsController** - POST `/api/segs/upsert` (есть тест для утилиты)

## Рекомендации по приоритетности

### Высокий приоритет (критичные операции):
1. createBlock
2. updateBlock
3. deleteBlock
4. createSeg
5. updateSeg
6. deleteSeg

### Средний приоритет (часто используемые операции):
1. getAllBlocks
2. getBlockById
3. renameBlock
4. recalculateZonesSectors
5. getAllSegs
6. getSegById
7. getSegsByBlockId
8. getZonesBySegId

### Низкий приоритет (утилитарные операции):
1. resetZonesSectors

## Примечания

- Все контроллеры должны быть протестированы согласно требованиям документации в `docs/modules/blocks.md` и `docs/modules/segs.md`
- Тесты должны проверять не только успешные сценарии, но и граничные случаи, валидацию, обработку ошибок
- Особое внимание следует уделить транзакционным операциям и каскадным обновлениям

