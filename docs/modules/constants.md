# Модуль Constants (Константы)

## Описание модуля

Модуль `constants` обеспечивает хранение пользовательских констант в базе данных. Пользователь может создавать именованные коллекции пар «ключ — значение» (все значения — строки). Модуль предоставляет CRUD-операции и получение константы как по id (MongoDB ObjectId), так и по уникальному ключу `name`.

## Сущности модуля

### Constant (Константа)

Константа — справочная сущность, представляющая коллекцию строковых пар ключ–значение. Документ содержит поле `name` — уникальный строковый ключ одним словом (slug), по которому константу можно однозначно найти; `title` — человекочитаемое название коллекции; `data` — объект, ключи и значения которого являются строками. Идентификатор документа генерируется MongoDB (`_id`). Документ имеет стандартные временные метки создания и обновления.

## Связи между сущностями

На текущий момент модуль не имеет явных связей с другими сущностями системы. Поле `name` может использоваться в других модулях как внешний ключ для привязки к нужной константе.

## Концепции и принятые решения

### Уникальность name

Поле `name` является уникальным ключом и должно быть одним словом (без пробелов). Это позволяет получать константу по имени (эндпоинт getConstantByName) и гарантирует отсутствие дубликатов по ключу. При создании и обновлении дубликат `name` или наличие пробелов в `name` приводит к ошибке валидации.

### Поле data

Поле `data` хранит объект с произвольными ключами и значениями типа string. При создании можно не передавать `data` — тогда используется пустой объект. Валидация на уровне модели гарантирует, что все значения в `data` — строки.

### Частичное обновление

Эндпоинт updateConstantById принимает в теле запроса только те поля, которые нужно изменить (`name`, `title`, `data` — все опциональны). Обновляются лишь переданные поля; непереданные остаются без изменений.

### Роли доступа

Чтение (получение по id, по name, список всех) доступно роли USER и выше. Создание и обновление — роли ADMIN. Удаление константы разрешено только роли PRIME, по аналогии с другими критичными операциями удаления в системе.

## API эндпоинты

### GET `/api/constants`

Получение списка всех констант (сортировка по дате создания, сначала новые).

**Запрос:**

- Query параметры отсутствуют

**Ответ:**

- 200: `{ message: string, data: Array<Constant> }`
- 500: `{ message: string, error?: any }` — ошибка сервера

**Доступ:** Требует роль USER

### GET `/api/constants/id/:id`

Получение константы по идентификатору.

**Запрос:**

- Path параметры: `id` (MongoDB ObjectId)

**Ответ:**

- 200: `{ message: string, data: Constant }`
- 400: `{ message: string, errors?: array }` — ошибка валидации
- 404: `{ message: string }` — константа не найдена
- 500: `{ message: string, error?: any }` — ошибка сервера

**Доступ:** Требует роль USER

### GET `/api/constants/name/:name`

Получение константы по ключу name.

**Запрос:**

- Path параметры: `name` (string)

**Ответ:**

- 200: `{ message: string, data: Constant }`
- 400: `{ message: string, errors?: array }` — ошибка валидации
- 404: `{ message: string }` — константа не найдена
- 500: `{ message: string, error?: any }` — ошибка сервера

**Доступ:** Требует роль USER

### POST `/api/constants`

Создание константы.

**Запрос:**

- Body: `{ name: string, title: string, data?: Record<string, string> }` (name — одним словом, без пробелов; data по умолчанию `{}`)

**Ответ:**

- 201: `{ message: string, data: Constant }`
- 400: `{ message: string, errors?: array }` — ошибка валидации
- 500: `{ message: string, error?: any }` — ошибка сервера (в т.ч. при дубликате name)

**Доступ:** Требует роль ADMIN

### PATCH `/api/constants/id/:id`

Обновление константы по id. В теле передаются только поля, которые нужно изменить.

**Запрос:**

- Path параметры: `id` (MongoDB ObjectId)
- Body: опционально `{ name?: string, title?: string, data?: Record<string, string> }`

**Ответ:**

- 200: `{ message: string, data: Constant }`
- 400: `{ message: string, errors?: array }` — ошибка валидации
- 404: `{ message: string }` — константа не найдена
- 500: `{ message: string, error?: any }` — ошибка сервера

**Доступ:** Требует роль ADMIN

### DELETE `/api/constants/id/:id`

Удаление константы по id.

**Запрос:**

- Path параметры: `id` (MongoDB ObjectId)

**Ответ:**

- 200: `{ message: string }`
- 400: `{ message: string, errors?: array }` — ошибка валидации
- 404: `{ message: string }` — константа не найдена
- 500: `{ message: string, error?: any }` — ошибка сервера

**Доступ:** Требует роль PRIME

## Формат данных Constant

- `_id`: string (MongoDB ObjectId)
- `name`: string — уникальный ключ (одним словом)
- `title`: string — название коллекции значений
- `data`: object — объект с ключами и значениями (строки)
- `createdAt`: Date
- `updatedAt`: Date
