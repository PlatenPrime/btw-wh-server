# Модуль Rows

## Описание модуля

Модуль `rows` решает задачи управления рядами склада. Ряды являются верхним уровнем иерархической структуры организации склада и служат для группировки паллет. Модуль обеспечивает создание и управление рядами, их привязку к паллетам, а также простую структуру для организации пространства склада. Модуль является основой для организации паллет на складе.

## Сущности модуля

### Row (Ряд)

Ряд представляет собой логическую группу паллет на складе. Это реальная организационная единица склада, которая объединяет несколько паллет для удобства управления. Ряд имеет уникальное название и массив ссылок на паллеты которые в него входят.

## Связи между сущностями

- **Row → Pallet**: Один ко многим. Каждый ряд может содержать множество паллет. Связь осуществляется через массив ObjectId в поле pallets ряда. Паллеты являются отдельной коллекцией, а не вложенными документами, что позволяет эффективно работать с ними независимо.

## Концепции и принятые решения

### Верхний уровень иерархии Row → Pallet → Pos

Структура склада организована в виде трехуровневой иерархии: ряды содержат паллеты, паллеты содержат позиции. Это позволяет гибко организовывать пространство склада и эффективно управлять большим количеством паллет и позиций. Ряды служат для логической группировки, паллеты для физической организации, позиции для конкретных единиц товара.

### Уникальность названий

Каждый ряд имеет уникальное название. Это обеспечивает однозначную идентификацию рядов и предотвращает дублирование.

### Транзакции

Операции создания и обновления рядов выполняются в рамках MongoDB транзакций. Это гарантирует целостность данных между рядами и паллетами.

## API эндпоинты

### GET `/api/rows`

Получение всех рядов.

**Запрос:**
- Query параметры отсутствуют

**Ответ:**
- 200: `Array<Row>`
- 500: `{ message: string, error?: any }` - ошибка сервера

**Доступ:** Требует роль USER

### GET `/api/rows/id/:id`

Получение ряда по идентификатору.

**Запрос:**
- Path параметры: `id` (MongoDB ObjectId)

**Ответ:**
- 200: `Row`
- 400: `{ message: string, errors?: array }` - неверный формат ID
- 404: `{ message: string }` - ряд не найден
- 500: `{ message: string, error?: any }` - ошибка сервера

**Доступ:** Требует роль USER

### GET `/api/rows/title/:title`

Получение ряда по названию.

**Запрос:**
- Path параметры: `title` (string)

**Ответ:**
- 200: `Row`
- 400: `{ message: string, errors?: array }` - название не указано
- 404: `{ message: string }` - ряд не найден
- 500: `{ message: string, error?: any }` - ошибка сервера

**Доступ:** Требует роль USER

### POST `/api/rows`

Создание нового ряда.

**Запрос:**
- Body: `{ title: string }`

**Ответ:**
- 201: `Row`
- 400: `{ message: string, errors?: array }` - ошибка валидации
- 409: `{ message: string }` - ряд с таким названием уже существует
- 500: `{ message: string, error?: any }` - ошибка сервера

**Доступ:** Требует роль ADMIN

### PUT `/api/rows/:id`

Обновление ряда.

**Запрос:**
- Path параметры: `id` (MongoDB ObjectId)
- Body: `{ title?: string }` (поле опционально)

**Ответ:**
- 200: `Row`
- 400: `{ message: string, errors?: array }` - ошибка валидации
- 404: `{ message: string }` - ряд не найден
- 409: `{ message: string }` - ряд с таким названием уже существует
- 500: `{ message: string, error?: any }` - ошибка сервера

**Доступ:** Требует роль ADMIN

### DELETE `/api/rows/:id`

Удаление ряда.

**Запрос:**
- Path параметры: `id` (MongoDB ObjectId)

**Ответ:**
- 200: `Row`
- 400: `{ message: string, errors?: array }` - неверный формат ID
- 404: `{ message: string }` - ряд не найден
- 500: `{ message: string, error?: any }` - ошибка сервера

**Примечание:** При удалении ряда все связанные паллеты теряют связь с рядом (поле row удаляется, поле rowData обновляется).

**Доступ:** Требует роль PRIME

## Форматы данных

### Row

```typescript
{
  _id: string;                    // MongoDB ObjectId
  title: string;                   // Уникальное название ряда
  pallets: Array<string>;         // Массив ObjectId паллет
  createdAt?: Date;                // Дата создания
  updatedAt?: Date;                // Дата обновления
}
```

