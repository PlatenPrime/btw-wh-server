# Модуль Konks (Конкуренты)

## Описание модуля

Модуль `konks` решает задачи учёта конкурентов. Он обеспечивает хранение справочника конкурентов с ключом-идентификатором (name), названием, ссылкой на сайт и ссылкой на изображение, а также CRUD-операции для управления этим справочником.

## Сущности модуля

### Konk (Конкурент)

Конкурент — справочная сущность, представляющая компанию-конкурента. Документ содержит поле `name` — уникальный строковый ключ одним словом (slug), по которому конкурента можно однозначно найти; `title` — полное название; `url` — ссылка на сайт конкурента; `imageUrl` — ссылка на изображение (логотип или иное). Идентификатор документа генерируется MongoDB (`_id`). Документ имеет стандартные временные метки создания и обновления.

## Связи между сущностями

На текущий момент модуль не имеет явных связей с другими сущностями системы. Поле `name` может использоваться в других модулях как внешний ключ для привязки к конкуренту.

## Концепции и принятые решения

### Уникальность name

Поле `name` является уникальным ключом и должно быть одним словом (без пробелов). Это позволяет получать конкурента по имени (эндпоинт getKonkByName) и гарантирует отсутствие дубликатов по ключу. При создании и обновлении дубликат `name` или наличие пробелов в `name` приводит к ошибке валидации.

### Частичное обновление

Эндпоинт updateKonkById принимает в теле запроса только те поля, которые нужно изменить (`name`, `title`, `url`, `imageUrl` — все опциональны). Обновляются лишь переданные поля; непереданные остаются без изменений.

### Роли доступа

Чтение (получение по id, по name, список всех) доступно роли USER и выше. Создание и обновление — роли ADMIN. Удаление конкурента разрешено только роли PRIME, по аналогии с другими критичными операциями удаления в системе.

## API эндпоинты

### GET `/api/konks`

Получение списка всех конкурентов (сортировка по дате создания, сначала новые).

**Запрос:**

- Query параметры отсутствуют

**Ответ:**

- 200: `{ message: string, data: Array<Konk> }`
- 500: `{ message: string, error?: any }` — ошибка сервера

**Доступ:** Требует роль USER

### GET `/api/konks/id/:id`

Получение конкурента по идентификатору.

**Запрос:**

- Path параметры: `id` (MongoDB ObjectId)

**Ответ:**

- 200: `{ message: string, data: Konk }`
- 400: `{ message: string, errors?: array }` — ошибка валидации
- 404: `{ message: string }` — конкурент не найден
- 500: `{ message: string, error?: any }` — ошибка сервера

**Доступ:** Требует роль USER

### GET `/api/konks/name/:name`

Получение конкурента по ключу name.

**Запрос:**

- Path параметры: `name` (string)

**Ответ:**

- 200: `{ message: string, data: Konk }`
- 400: `{ message: string, errors?: array }` — ошибка валидации
- 404: `{ message: string }` — конкурент не найден
- 500: `{ message: string, error?: any }` — ошибка сервера

**Доступ:** Требует роль USER

### POST `/api/konks`

Создание конкурента.

**Запрос:**

- Body: `{ name: string, title: string, url: string, imageUrl: string }` (name — одним словом, без пробелов)

**Ответ:**

- 201: `{ message: string, data: Konk }`
- 400: `{ message: string, errors?: array }` — ошибка валидации
- 500: `{ message: string, error?: any }` — ошибка сервера (в т.ч. при дубликате name)

**Доступ:** Требует роль ADMIN

### PATCH `/api/konks/id/:id`

Обновление конкурента по id. В теле передаются только поля, которые нужно изменить.

**Запрос:**

- Path параметры: `id` (MongoDB ObjectId)
- Body: опционально `{ name?: string, title?: string, url?: string, imageUrl?: string }`

**Ответ:**

- 200: `{ message: string, data: Konk }`
- 400: `{ message: string, errors?: array }` — ошибка валидации
- 404: `{ message: string }` — конкурент не найден
- 500: `{ message: string, error?: any }` — ошибка сервера

**Доступ:** Требует роль ADMIN

### DELETE `/api/konks/id/:id`

Удаление конкурента по id.

**Запрос:**

- Path параметры: `id` (MongoDB ObjectId)

**Ответ:**

- 200: `{ message: string }`
- 400: `{ message: string, errors?: array }` — ошибка валидации
- 404: `{ message: string }` — конкурент не найден
- 500: `{ message: string, error?: any }` — ошибка сервера

**Доступ:** Требует роль PRIME

## Формат данных Konk

- `_id`: string (MongoDB ObjectId)
- `name`: string — уникальный ключ (одним словом)
- `title`: string — название конкурента
- `url`: string — ссылка на сайт конкурента
- `imageUrl`: string — ссылка на изображение
- `createdAt`: Date
- `updatedAt`: Date
