# ‚úÖ –†–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π

## üìÖ –î–∞—Ç–∞: 14 –æ–∫—Ç—è–±—Ä—è 2025

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –∏ —Ç–∏–ø–æ–≤ –¥–ª—è —Ä–æ–ª–µ–π

**–§–∞–π–ª:** `src/constants/roles.ts`

- –°–æ–∑–¥–∞–Ω enum `RoleType` —Å —Ç—Ä–µ–º—è —Ä–æ–ª—è–º–∏: PRIME, ADMIN, USER
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π (PRIME > ADMIN > USER)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
  - `hasRoleAccess()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è –¥–æ—Å—Ç—É–ø–∞
  - `isValidRole()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–æ–ª–∏

### 2. ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ Express Request

**–§–∞–π–ª:** `src/types/express.d.ts`

- –†–∞—Å—à–∏—Ä–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Express Request
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `user` —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞ (id, role)
- –û–±–µ—Å–ø–µ—á–µ–Ω–∞ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–æ –≤—Å–µ—Ö middleware

### 3. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ middleware checkAuth

**–§–∞–π–ª:** `src/middleware/checkAuth.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞ (Bearer <token>)
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ req.user

**–ö–æ–¥—ã –æ—à–∏–±–æ–∫:**

- `NO_TOKEN` (401)
- `INVALID_TOKEN_FORMAT` (401)
- `TOKEN_EXPIRED` (401)
- `INVALID_TOKEN` (401)
- `INVALID_TOKEN_PAYLOAD` (401)

### 4. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ middleware checkRoles

**–§–∞–π–ª:** `src/middleware/checkRoles.ts`

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

1. **checkRoles(requiredRoles: RoleType[])**

   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—é —Ä–æ–ª–µ–π
   - –ö–æ–¥—ã –æ—à–∏–±–æ–∫: `INSUFFICIENT_PERMISSIONS` (403)

2. **checkOwnership(getUserIdFromResource)**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ä–µ—Å—É—Ä—Å–∞
   - PRIME –∏ ADMIN –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É
   - USER –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ä–µ—Å—É—Ä—Å—ã
   - –ö–æ–¥—ã –æ—à–∏–±–æ–∫: `NOT_RESOURCE_OWNER` (403)

### 5. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ generateAccessToken

**–§–∞–π–ª:** `src/modules/auth/utils/generateAccessToken.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `expiresIn` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 24 —á–∞—Å–∞)
- –¢–æ–∫–µ–Ω —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
- –£–ª—É—á—à–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è JSDoc

### 6. ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ middleware –∫ —Ä–æ—É—Ç–∞–º

–û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ä–æ—É—Ç—ã:

#### **Auth Router** (`src/modules/auth/router.ts`)

- `/login`, `/register` - –ø—É–±–ª–∏—á–Ω—ã–µ
- `/users` - —Ç–æ–ª—å–∫–æ ADMIN –∏ PRIME
- `/users/:id`, `/me/:id` - –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
- `/users/:userId` (PUT) - —Ç–æ–ª—å–∫–æ ADMIN –∏ PRIME
- `/roles` - —Ç–æ–ª—å–∫–æ ADMIN –∏ PRIME

#### **Asks Router** (`src/modules/asks/router.ts`)

- GET –∑–∞–ø—Ä–æ—Å—ã - –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
- POST (—Å–æ–∑–¥–∞—Ç—å) - –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
- PUT, DELETE - –≤–ª–∞–¥–µ–ª–µ—Ü + ADMIN/PRIME
- PATCH (complete, reject, actions) - —Ç–æ–ª—å–∫–æ ADMIN –∏ PRIME

#### **Arts Router** (`src/modules/arts/router.ts`)

- GET –∑–∞–ø—Ä–æ—Å—ã - –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
- PATCH, POST - —Ç–æ–ª—å–∫–æ ADMIN –∏ PRIME

#### **Pallets Router** (`src/modules/pallets/router.ts`)

- GET –∑–∞–ø—Ä–æ—Å—ã - –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
- POST, PUT, DELETE - —Ç–æ–ª—å–∫–æ ADMIN –∏ PRIME

#### **Poses Router** (`src/modules/poses/router.ts`)

- GET –∑–∞–ø—Ä–æ—Å—ã - –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
- POST, PUT, DELETE - —Ç–æ–ª—å–∫–æ ADMIN –∏ PRIME

#### **Rows Router** (`src/modules/rows/router.ts`)

- GET –∑–∞–ø—Ä–æ—Å—ã - –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
- POST, PUT, DELETE - —Ç–æ–ª—å–∫–æ ADMIN –∏ PRIME

#### **Defs Router** (`src/modules/defs/router.ts`)

- GET –∑–∞–ø—Ä–æ—Å—ã - –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
- POST (calculate) - —Ç–æ–ª—å–∫–æ ADMIN –∏ PRIME

### 7. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

#### **–î–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:**

**–§–∞–π–ª:** `FRONTEND_AUTH_GUIDE.md`

–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –≤–∫–ª—é—á–∞–µ—Ç:

- –û–ø–∏—Å–∞–Ω–∏–µ —Ä–æ–ª–µ–π –∏ –∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
- –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≤—Ö–æ–¥)
- –†–∞–±–æ—Ç–∞ —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏
- –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (Fetch, Axios, React Query)
- –ü–æ–ª–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
- –ö–æ–¥—ã –æ—à–∏–±–æ–∫ –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- Custom hooks –¥–ª—è React
- TypeScript —Ç–∏–ø—ã

#### **–î–ª—è –±—ç–∫–µ–Ω–¥–∞:**

**–§–∞–π–ª:** `src/middleware/README.md`

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

- –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö middleware
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π
- Best practices
- –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è Auth:**

**–§–∞–π–ª:** `src/modules/auth/README.md`

–î–æ–±–∞–≤–ª–µ–Ω–æ:

- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ú–∞—Ç—Ä–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
- –ö–æ–¥—ã –æ—à–∏–±–æ–∫
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JWT —Ç–æ–∫–µ–Ω–∞
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å —Ç–æ–∫–µ–Ω–æ–º

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:** 5
- **–û–±–Ω–æ–≤–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 8
- **–ó–∞—â–∏—â–µ–Ω–æ —Ä–æ—É—Ç–æ–≤:** 7 –º–æ–¥—É–ª–µ–π
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~800+
- **–û—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞:** 0

---

## üîê –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π

### –ò–µ—Ä–∞—Ä—Ö–∏—è

```
PRIME (—É—Ä–æ–≤–µ–Ω—å 3) - –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
   ‚Üì
ADMIN (—É—Ä–æ–≤–µ–Ω—å 2) - –°–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π
   ‚Üì
USER  (—É—Ä–æ–≤–µ–Ω—å 1) - –ß—Ç–µ–Ω–∏–µ + –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```

### –ú–∞—Ç—Ä–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–∞

| –û–ø–µ—Ä–∞—Ü–∏—è                                 | USER | ADMIN | PRIME |
| ---------------------------------------- | ---- | ----- | ----- |
| –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö                            | ‚úÖ   | ‚úÖ    | ‚úÖ    |
| –°–æ–∑–¥–∞–Ω–∏–µ asks                            | ‚úÖ   | ‚úÖ    | ‚úÖ    |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–∏—Ö asks                | ‚úÖ   | ‚úÖ    | ‚úÖ    |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–∂–∏—Ö asks                | ‚ùå   | ‚úÖ    | ‚úÖ    |
| –°–æ–∑–¥–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π (arts, pallets, etc.) | ‚ùå   | ‚úÖ    | ‚úÖ    |
| –£–¥–∞–ª–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π                       | ‚ùå   | ‚úÖ    | ‚úÖ    |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏                | ‚ùå   | ‚úÖ    | ‚úÖ    |
| –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π              | ‚ùå   | ‚úÖ    | ‚úÖ    |

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã:

1. **JWT —Ç–æ–∫–µ–Ω—ã —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º** (24 —á–∞—Å–∞)
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤** –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞—â–∏—â–µ–Ω–Ω–æ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ
3. **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π**
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ä–µ—Å—É—Ä—Å–∞** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–î–µ—Ç–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
6. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π** (bcrypt)
7. **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ TypeScript

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:**

   ```typescript
   // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø–æ—Å–ª–µ login
   const { token, user } = await login(credentials);
   localStorage.setItem("authToken", token);
   ```

2. **–°–æ–∑–¥–∞—Ç—å axios instance —Å interceptors:**

   ```typescript
   api.interceptors.request.use((config) => {
     const token = localStorage.getItem("authToken");
     if (token) config.headers.Authorization = `Bearer ${token}`;
     return config;
   });
   ```

3. **–ó–∞—â–∏—Ç–∏—Ç—å —Ä–æ—É—Ç—ã:**

   ```typescript
   <ProtectedRoute allowedRoles={["ADMIN", "PRIME"]}>
     <AdminPanel />
   </ProtectedRoute>
   ```

4. **–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**

   ```typescript
   if (error.code === "TOKEN_EXPIRED") {
     // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ /login
   }
   ```

5. **–£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø–æ —Ä–æ–ª—è–º:**
   ```typescript
   {
     user?.role === "ADMIN" && <DeleteButton />;
   }
   ```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–î–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:** `FRONTEND_AUTH_GUIDE.md`
- **–î–ª—è –±—ç–∫–µ–Ω–¥–∞:** `src/middleware/README.md`
- **API –º–æ–¥—É–ª—è Auth:** `src/modules/auth/README.md`

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞, –∫–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º TypeScript/Express.

---

**–ê–≤—Ç–æ—Ä:** –ú–∏–∫–∞—Å–∞  
**–î–∞—Ç–∞:** 14 –æ–∫—Ç—è–±—Ä—è 2025
